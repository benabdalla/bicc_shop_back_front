<div class="page-wrapper">
  <!-- Enhanced Category Menu Section -->
  <section class="category-section" *ngIf="!loading">
    <div class="container">
      <div class="category-menu-enhanced">
        <!-- Category Navigation -->
        <div class="category-navigation">
          <div class="category-scroll-wrapper">
            <div class="category-scroll-container" #categoryContainer>
              <!-- All Products Button -->
              <button
                class="category-btn-simple"
                (click)="onCategorySelect(null)"
              >
                <div class="category-icon">
                  <i class="bi bi-grid-3x3-gap-fill"></i>
                </div>
                <span class="category-text">Tous les produits</span>
              </button>

              <!-- Category Items -->
              <button
                *ngFor="let category of categories"
                class="category-btn-simple"
                (click)="onCategorySelect(category.id)"
              >
                <div class="category-icon">
                  <i class="bi bi-tag-fill"></i>
                </div>
                <span class="category-text">{{ category.title }}</span>
              </button>
            </div>

            <button
              class="scroll-btn scroll-right"
              (click)="scrollCategories('right')"
              *ngIf="showScrollButtons"
            >
              <i class="bi bi-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="mt-2">
    <div id="carouselExampleCaptions" class="carousel slide">
      <div class="carousel-indicators">
        <button
          type="button"
          data-bs-target="#carouselExampleCaptions"
          data-bs-slide-to="0"
          class="active"
          aria-current="true"
          aria-label="Slide 1"
        ></button>
        <button
          type="button"
          data-bs-target="#carouselExampleCaptions"
          data-bs-slide-to="1"
          aria-label="Slide 2"
        ></button>
        <button
          type="button"
          data-bs-target="#carouselExampleCaptions"
          data-bs-slide-to="2"
          aria-label="Slide 3"
        ></button>
      </div>
      <div class="carousel-inner">
        <div class="carousel-item">
          <img
            src="../../../assets/images/slides/slide1.jpg"
            class="d-block w-100"
            style="height: 420px"
            alt="Présentation des produits - diapositive 1"
          />
        </div>
        <div class="carousel-item active">
          <img
            src="../../../assets/images/slides/slide2.jpg"
            class="d-block w-100"
            style="height: 420px"
            alt="Présentation des produits - diapositive 2"
          />
        </div>
        <div class="carousel-item">
          <img
            src="../../../assets/images/slides/slide3.jpg"
            class="d-block w-100"
            style="height: 420px"
            alt="Présentation des produits - diapositive 3"
          />
        </div>
      </div>
      <button
        class="carousel-control-prev"
        type="button"
        data-bs-target="#carouselExampleCaptions"
        data-bs-slide="prev"
      >
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Précédent</span>
      </button>
      <button
        class="carousel-control-next"
        type="button"
        data-bs-target="#carouselExampleCaptions"
        data-bs-slide="next"
      >
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Suivant</span>
      </button>
    </div>
  </section>

  <!-- Loading Section -->
  <section class="container" *ngIf="loading">
    <div class="text-center py-5">
      <output class="spinner-border text-primary" aria-live="polite">
        <span class="visually-hidden">Chargement...</span>
      </output>
      <p class="mt-2">Chargement des catégories et produits...</p>
    </div>
  </section>

  <section class="container">
    <div class="d-flex align-items-center gap-1 mb-4">
      <svg
        class="svg-style"
        focusable="false"
        aria-hidden="true"
        viewBox="0 0 24 24"
      >
        <path
          d="M19.0765 9.48063H12.1242L15.5905 0L5 14.5194H11.9522L8.48592 24L19.0765 9.48063Z"
        ></path>
      </svg>

      <h2 class="fw-bold fs-3 m-0">Nos nouveaux produits</h2>
    </div>

    <!-- Products Carousel -->
    <div class="products-carousel-wrapper" *ngIf="products.length > 0">
      <div class="products-carousel-container">
        <!-- Navigation Buttons -->
        <button
          class="carousel-nav-btn carousel-nav-prev"
          (click)="scrollProductsCarousel('prev')"
          [disabled]="!canScrollPrev"
          aria-label="Produits précédents"
        >
          <i class="bi bi-chevron-left"></i>
        </button>

        <button
          class="carousel-nav-btn carousel-nav-next"
          (click)="scrollProductsCarousel('next')"
          [disabled]="!canScrollNext"
          aria-label="Produits suivants"
        >
          <i class="bi bi-chevron-right"></i>
        </button>

        <!-- Carousel Track -->
        <div class="products-carousel-track" #carouselTrack>
          <div class="products-carousel-slide">
            <div
              *ngFor="let p of getCarouselProducts(); let i = index"
              class="product-carousel-item"
              [attr.data-index]="i"
            >
              <div
                class="card product-card h-100"
                (click)="showProduct(p.id)"
                (keydown.enter)="showProduct(p.id)"
                (keydown.space)="showProduct(p.id)"
                [attr.aria-label]="'Voir les détails pour ' + p.title"
              >
                <div class="card-image-container">
                  <img
                    src="{{ host + getFirstImage(p) }}"
                    class="card-img-top product-image"
                    [alt]="p.title"
                    loading="lazy"
                  />
                  <div class="image-overlay">
                    <i class="bi bi-eye-fill"></i>
                    <span>Voir détails</span>
                  </div>
                </div>

                <!-- Discount Badge -->
                <div
                  class="position-absolute top-0 end-0 m-2 product-discount"
                  *ngIf="p.salePrice > 0 && p.salePrice < p.regularPrice"
                >
                  <span class="discount-badge">{{ getDiscountPercentage(p) }}</span>
                </div>

                <!-- New/Featured Badge -->
                <div class="position-absolute top-0 start-0 m-2 product-badge">
                  <span class="new-badge">Nouveau</span>
                </div>

                <div class="card-body d-flex flex-column">
                  <h6 class="card-title product-title">{{ p.title }}</h6>

                  <!-- Pricing -->
                  <div class="price-container mt-auto">
                    <div
                      *ngIf="p.salePrice > 0 && p.salePrice !== p.regularPrice"
                      class="price-discount"
                    >
                      <span class="original-price">{{ p.regularPrice }} TND</span>
                      <span class="sale-price">{{ p.salePrice }} TND</span>
                    </div>

                    <div
                      *ngIf="!(p.salePrice > 0 && p.salePrice !== p.regularPrice)"
                      class="price-single"
                    >
                      <span class="current-price">{{ p.regularPrice }} TND</span>
                    </div>
                  </div>

                  <!-- Quick Actions -->
                  <div class="quick-actions mt-3">
                    <button
                      class="btn btn-outline-primary btn-sm quick-btn flex-fill"
                      (click)="addToCart(p, $event)"
                      title="Ajouter au panier"
                    >
                      <i class="bi bi-cart-plus"></i>
                      <span class="d-none d-md-inline">Ajouter</span>
                    </button>

                    <button
                      class="btn btn-success btn-sm quick-btn buy-now-btn flex-fill"
                      (click)="buyNow(p, $event)"
                      title="Acheter maintenant"
                    >
                      <i class="bi bi-lightning-fill"></i>
                      <span class="d-none d-md-inline">Acheter</span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Carousel Indicators -->
        <div class="carousel-indicators-custom">
          <div class="indicators-wrapper">
            <span
              *ngFor="let indicator of getCarouselIndicators(); let i = index"
              class="indicator"
              [class.active]="i === currentSlideIndex"
              (click)="goToSlide(i)"
              [attr.aria-label]="'Aller à la diapositive ' + (i + 1)"
            ></span>
          </div>
        </div>
      </div>

      <!-- Show More Button -->
      <div
        class="text-center mt-4"
        *ngIf="products.length > 10"
      >
        <button
          class="btn btn-outline-primary btn-lg show-more-btn"
          (click)="showAllProducts()"
        >
          <i class="bi bi-grid-3x3-gap"></i>
          Voir tous les produits ({{ products.length }})
        </button>
      </div>
    </div>

    <!-- No Products Message -->
    <div *ngIf="products.length === 0" class="text-center py-5">
      <div class="empty-state">
        <i class="bi bi-box-seam display-1 text-muted"></i>
        <h4 class="text-muted mt-3">Aucun produit trouvé</h4>
        <p class="text-muted">
          Revenez plus tard pour découvrir de nouveaux produits.
        </p>
      </div>
    </div>
  </section>
</div>
