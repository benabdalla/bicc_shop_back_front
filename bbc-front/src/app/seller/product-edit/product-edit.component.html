<div class="page-content">
  <div class="card">
    <div class="card-body p-4">
      <h5 class="card-title">Modifier le produit</h5>
      <hr />
      <div class="form-body mt-4">
        <form #_form="ngForm" (submit)="updateProduct(_form.value)">
          <div class="row">
            <div class="col-lg-8">
              <div class="border border-3 p-4 rounded">
                <div class="mb-3">
                  <label for="inputProductTitle" class="form-label"
                    >Nom du produit</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="inputProductTitle"
                    placeholder="Saisir le nom du produit"
                    name="title"
                    ngModel
                    [(ngModel)]="title"
                  />
                </div>
                <!-- Multi-Image Upload Section -->
                <div class="mb-3">
                  <label class="form-label">Images du produit</label>

                  <!-- Drag & Drop Upload Zone -->
                  <div
                    class="upload-zone"
                    [class.drag-over]="isDragOver"
                    (dragover)="onDragOver($event)"
                    (dragleave)="onDragLeave($event)"
                    (drop)="onDrop($event)"
                    (click)="triggerFileInput()"
                  >
                    <div class="upload-content">
                      <i class="bi bi-cloud-upload display-6 text-primary"></i>
                      <h6 class="mt-2">
                        Glissez-déposez les images ici ou cliquez pour parcourir
                      </h6>
                      <p class="text-muted small mb-0">
                        Formats supportés : JPG, PNG, GIF, WebP | Taille max :
                        5Mo/image
                      </p>
                    </div>
                  </div>

                  <!-- Hidden File Input -->
                  <input
                    type="file"
                    id="inputProductImages"
                    class="d-none"
                    accept="image/*"
                    multiple
                    (change)="onMultipleImagesSelected($event)"
                  />

                  <!-- Upload Progress -->
                  <div *ngIf="uploadingImages" class="mt-3">
                    <div
                      class="d-flex justify-content-between align-items-center mb-2"
                    >
                      <small class="text-muted"
                        >Téléchargement des images...</small
                      >
                      <small class="text-muted"
                        >{{ uploadingCount }} / {{ totalUploadCount }}</small
                      >
                    </div>
                    <div class="progress mb-2">
                      <div
                        class="progress-bar progress-bar-striped progress-bar-animated"
                        [style.width.%]="
                          (uploadingCount / totalUploadCount) * 100
                        "
                      ></div>
                    </div>
                    <div
                      *ngFor="let progress of getUploadProgressArray()"
                      class="small text-muted"
                    >
                      {{ progress.filename }}: {{ progress.progress }}%
                    </div>
                  </div>

                  <!-- Current Images Gallery -->
                  <div *ngIf="productImages.length > 0" class="mt-3">
                    <div
                      class="d-flex justify-content-between align-items-center mb-2"
                    >
                      <small class="text-muted"
                        >{{ productImages.length }} image(s) uploaded</small
                      >
                      <button
                        type="button"
                        class="btn btn-sm btn-outline-danger"
                        (click)="clearAllImages()"
                      >
                        <i class="bi bi-trash me-1"></i>
                        Tout supprimer
                      </button>
                    </div>

                    <!-- Images Grid -->
                    <div class="images-grid">
                      <div
                        *ngFor="let image of productImages; let i = index"
                        class="image-preview-item"
                        draggable="true"
                        (dragstart)="onImageDragStart($event, i)"
                        (dragover)="onImageDragOver($event)"
                        (drop)="onImageDrop($event, i)"
                      >
                        <div class="image-order-number">{{ i + 1 }}</div>
                        <img
                          [src]="getImageDisplayUrl(image)"
                          alt="Product preview {{ i + 1 }}"
                          class="preview-image"
                        />
                        <button
                          type="button"
                          class="btn btn-sm btn-danger remove-btn"
                          (click)="removeImage(i)"
                          [title]="'Remove image ' + (i + 1)"
                        >
                          <i class="bi bi-x"></i>
                        </button>
                        <div
                          class="drag-handle"
                          title="Glisser pour réorganiser"
                        >
                          <i class="bi bi-grip-vertical"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="mb-3">
                  <label for="inputProductDescription" class="form-label"
                    >Description</label
                  >
                  <textarea
                    class="form-control"
                    id="inputProductDescription"
                    rows="3"
                    name="description"
                    ngModel
                    [(ngModel)]="description"
                  ></textarea>
                </div>
                <!-- <div class="mb-3">
                                <label for="inputProductDescription" class="form-label">Product Images</label>
                                <input id="image-uploadify" type="file"
                                    accept=".xlsx,.xls,image/*,.doc,audio/*,.docx,video/*,.ppt,.pptx,.txt,.pdf"
                                    multiple>
                            </div> -->
              </div>
            </div>
            <div class="col-lg-4">
              <div class="border border-3 p-4 rounded">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label for="inputRegularPrice" class="form-label"
                      >Prix normal</label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="inputRegularPrice"
                      placeholder="00.00"
                      name="regularPrice"
                      ngModel
                      [(ngModel)]="regularPrice"
                    />
                  </div>
                  <div class="col-md-6">
                    <label for="inputSalePrice" class="form-label"
                      >Prix promotionnel</label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="inputSalePrice"
                      placeholder="00.00"
                      name="salePrice"
                      ngModel
                      [(ngModel)]="salePrice"
                    />
                  </div>
                  <div class="col-12">
                    <label for="inputProductCategory" class="form-label"
                      >Catégorie du produit</label
                    >
                    <select
                      class="form-select"
                      id="inputProductCategory"
                      name="category"
                      ngModel
                      [(ngModel)]="category"
                    >
                      <option
                        *ngFor="let c of categories"
                        [selected]="category == '{{c.id}}'"
                        value="{{ c.id }}"
                      >
                        {{ c.title }}
                      </option>
                    </select>
                  </div>
                  <div class="col-12">
                    <label for="inputStockStatus" class="form-label"
                      >Statut du stock</label
                    >
                    <select
                      class="form-select"
                      id="inputStockStatus"
                      name="stockStatus"
                      ngModel
                      [(ngModel)]="stockStatus"
                    >
                      <option
                        value="In Stock"
                        [selected]="stockStatus == 'In Stock'"
                      >
                        En stock
                      </option>
                      <option
                        value="Out of Stock"
                        [selected]="stockStatus == 'Out of Stock'"
                      >
                        Rupture de stock
                      </option>
                    </select>
                  </div>
                  <div class="col-12">
                    <label for="inputStockCount" class="form-label"
                      >Quantité en stock</label
                    >
                    <input
                      type="number"
                      class="form-control"
                      id="inputStockCount"
                      placeholder="0"
                      name="stockCount"
                      ngModel
                      [(ngModel)]="stockCount"
                    />
                  </div>
                  <!-- <div class="col-12">
                                    <label for="inputStatus" class="form-label">Status</label>
                                    <select class="form-select" id="inputStatus" name="status" ngModel>
                                        <option></option>
                                        <option value="Pending">Pending</option>
                                        <option value="Published">Published</option>
                                        <option value="Rejected">Rejected</option>
                                    </select>
                                </div> -->
                  <div class="col-12">
                    <div class="d-grid">
                      <button type="submit" class="btn btn-primary">
                        Mettre à jour le produit
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!--end row-->
        </form>
      </div>
    </div>
  </div>
</div>
